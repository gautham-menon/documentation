(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{246:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return b})),n.d(t,"default",(function(){return p}));var a=n(3),r=n(7),o=(n(0),n(367)),l=["components"],c={title:"Code",sidebar_label:"Code"},i={unversionedId:"platform_concepts/studio/cloud-function",id:"platform_concepts/studio/cloud-function",isDocsHomePage:!1,title:"Code",description:"How to create a new function?",source:"@site/docs/platform_concepts/studio/cloud-function.md",slug:"/platform_concepts/studio/cloud-function",permalink:"/docs/platform_concepts/studio/cloud-function",version:"current",sidebar_label:"Code",sidebar:"platform_concepts",previous:{title:"How to train a bot?",permalink:"/docs/platform_concepts/studio/bot-training"},next:{title:"Publish your Bot",permalink:"/docs/platform_concepts/studio/modes"}},b=[{value:"How to create a new function?",id:"how-to-create-a-new-function",children:[]},{value:"Useful args you can access in code",id:"useful-args-you-can-access-in-code",children:[]},{value:"Useful Code Snippets",id:"useful-code-snippets",children:[{value:"Autocomplete",id:"autocomplete",children:[]},{value:"Decode BASE64",id:"decode-base64",children:[]}]},{value:"Steps to Display Multiple Variables using Transformation Function:",id:"steps-to-display-multiple-variables-using-transformation-function",children:[]}],s={toc:b};function p(e){var t=e.components,n=Object(r.a)(e,l);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"how-to-create-a-new-function"},"How to create a new function?"),Object(o.b)("p",null,"You can add a new function to write your custom logic in code in the ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("inlineCode",{parentName:"strong"},"code"))," section of the studio.\nTo execute these functions in a flow, you can attach function action node."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Format of cloud functions")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"return new Promise(resolve => {\n      // Your logic goes here\n      resolve();\n  }); \n")),Object(o.b)("hr",null),Object(o.b)("h2",{id:"useful-args-you-can-access-in-code"},"Useful args you can access in code"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",{parentName:"tr",align:null},"arg"),Object(o.b)("th",{parentName:"tr",align:null},"data type"),Object(o.b)("th",{parentName:"tr",align:null},"Use"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"data.variables.<variable_name>"),Object(o.b)("td",{parentName:"tr",align:null},"Key : String, Value: any"),Object(o.b)("td",{parentName:"tr",align:null},"To access any bot variable in code.")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"data.channel"),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"To access channel names like whatsapp, yellowmessenger, facebook etc")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"data.profile"),Object(o.b)("td",{parentName:"tr",align:null},"Object"),Object(o.b)("td",{parentName:"tr",align:null},"Contains user profile values like name, number, email, city , country, language")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"data.sender"),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"User ID")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"data.bot"),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"Bot ID")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"data.message"),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"To access Last/latest user message in the conversation")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"data.event.<event_name>"),Object(o.b)("td",{parentName:"tr",align:null},"Object"),Object(o.b)("td",{parentName:"tr",align:null},"To access events in code")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"ymLib.args.apiResponse"),Object(o.b)("td",{parentName:"tr",align:null},"any"),Object(o.b)("td",{parentName:"tr",align:null},"To access API response in API transformation function")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"ymLib.args.logger"),Object(o.b)("td",{parentName:"tr",align:null},"Object"),Object(o.b)("td",{parentName:"tr",align:null},"Can be used to add logs")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"context.history"),Object(o.b)("td",{parentName:"tr",align:null},"Object"),Object(o.b)("td",{parentName:"tr",align:null},"Contains history of nodes visited by user")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"prediction.intents"),Object(o.b)("td",{parentName:"tr",align:null}),Object(o.b)("td",{parentName:"tr",align:null},"To get Intents predicted from user message")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},"prediction.entities"),Object(o.b)("td",{parentName:"tr",align:null}),Object(o.b)("td",{parentName:"tr",align:null},"To get entities predicted from user message")))),Object(o.b)("hr",null),Object(o.b)("h2",{id:"useful-code-snippets"},"Useful Code Snippets"),Object(o.b)("h3",{id:"autocomplete"},"Autocomplete"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},'return new Promise(resolve => {\n    console.log("inside autoSuggestion");\n    let result = data.variables.autoComponents;\n    const { term } = data;\n    let suggestions = [];\n    result.forEach((hit) => {\n        if (hit.component.toLowerCase().includes(term.toLowerCase())) {\n            suggestions.push([hit.component, hit.component]);\n        }\n    });\n    resolve(suggestions);\n});\n')),Object(o.b)("h3",{id:"decode-base64"},"Decode BASE64"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"The Base64 Alphabet contains 64 basic ASCII characters.")),Object(o.b)("p",null,"If we receive an encrypted string through API, then we need to decrypt it first then only we can get the actual object. Then upload to YM Server, at last we can share the URL."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},'    let call_api = await app.executeApi(\'api_name\', { argument: _value});\n    let api_data = JSON.parse(call_api.body);\n    app.log(api_data, "#####API DATA");\n\n    let buffer = new Buffer.from(api_data.obj_name, "base64"); // Decode the file\n    let file_url = await app.uploadFile(buffer, \'File.pdf\');  // Upload the file to YM server\n    // await app.sendDocument(file_url, { caption:"FILE", filename: \'File.pdf\', mime: \'application/pdf\' });\n    // Share the File URL\n    await app.sendCards([\n        {\n            title: "Kindly download the same as PDF",\n            actions: [{\n                title: "DOWNLOAD",\n                url: file_url\n            }]\n        }\n    ]);\n')),Object(o.b)("p",null,"For more information : ",Object(o.b)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Glossary/Base64"},"Click Here")),Object(o.b)("h2",{id:"steps-to-display-multiple-variables-using-transformation-function"},"Steps to Display Multiple Variables using Transformation Function:"),Object(o.b)("p",null,"Transformation Function can be used to parse data through an API. We can also use this function to manipulate API responses."),Object(o.b)("p",null,"In this document, we are going to use the Transformation Function to parse Weather Data API and to show the different parameters in a carousel format. "),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"Step 1")),": Go to Studio \u2013> Code \u2013> click on Add new function\nFor example:  transformationFunction (as shown below)."),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://i.imgur.com/VhtUaHr.png",alt:null})),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"Step 2")),": The API response is given in JSON object (as shown below) for the temperature details."),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://i.imgur.com/xiQ3wUM.png",alt:null})),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"Step 3")),": The next step would be to fetch and parse the API response as JSON object. "),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://i.imgur.com/ZE7whNf.png",alt:null})),Object(o.b)("p",null,"In the above code, we are parsing the Weather Data and storing the response body in a variable \u201cmain\u201d."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"Step 4")),": The API data is now ready to be used in your bot journey. "),Object(o.b)("p",null,"You can store the entire JSON body data in a variable and parse through them for each parameter of weather data that you want to display in the bot."),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://i.imgur.com/mWH4Vy6.png",alt:null})),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"Step 5")),": Once the global variable is added, go to the respective API node and store the response in that global variable as shown below:"),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://i.imgur.com/SI6adHZ.png",alt:null})),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"Step 6")),": You can now use any prompt to display this data. "),Object(o.b)("p",null,"In our example, a carousel is used to display the Temperature and Wind details. You can also add an image of your choice (optional)."),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://i.imgur.com/5ZynLHG.png",alt:null})),Object(o.b)("p",null,"You can use the variable symbol and access the various parameters of the JSON object as shown in the above example."),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://i.imgur.com/gBjO3vm.png",alt:null})),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"Voila")),", your Weather Bot is ready to use!!!!"))}p.isMDXComponent=!0},367:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),s=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=s(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,b=i(e,["components","mdxType","originalType","parentName"]),p=s(n),d=a,m=p["".concat(l,".").concat(d)]||p[d]||u[d]||o;return n?r.a.createElement(m,c(c({ref:t},b),{},{components:n})):r.a.createElement(m,c({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:a,l[1]=c;for(var b=2;b<o;b++)l[b]=n[b];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);